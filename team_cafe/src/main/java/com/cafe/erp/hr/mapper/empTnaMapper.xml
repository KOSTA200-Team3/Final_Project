<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cafe.erp.hr.model.empTnaDAO">
	

<insert id ="insertEmpTna" parameterType="com.cafe.erp.hr.model.empTnaDTO">
		insert into cafe_emptna(emptna_code,emptna_empcode,emptna_year,
		emptna_month,emptna_day,emptna_starttime) values( 
		(select nvl(max(emptna_code),0)+1 from cafe_emptna), 
		(select employee_code from cafe_employee where employee_name=#{employee_name} and employee_jumin=#{employee_jumin})
		,to_number(to_char(sysdate,'yyyy')),to_number(to_char(sysdate,'mm'))
		,to_number(to_char(sysdate,'dd')),to_number(to_char(sysdate,'hh24')))
</insert>



<update id="updateEmpTna" parameterType="hashmap" >
	update cafe_emptna set emptna_endtime=(to_number(to_char(sysdate,'hh24'))),
	emptna_daytotaltime=(select emptna_endtime+(emptna_starttime*-1) from cafe_emptna where emptna_year=(to_number(to_char(sysdate,'yyyy'))) 
	 and emptna_month=(to_number(to_char(sysdate,'mm'))) 
	 and emptna_day=(to_number(to_char(sysdate,'dd')))
     and emptna_empcode=(select distinct b.emptna_empcode from cafe_employee a inner join cafe_emptna b 
	on a.employee_code = b.emptna_empcode where a.employee_name=#{employee_name} and a.employee_jumin=#{employee_jumin})),emptna_monthtotaltime=#{total}
	where emptna_empcode= (select distinct b.emptna_empcode from cafe_employee a inner join cafe_emptna b 
	on a.employee_code = b.emptna_empcode where a.employee_name=#{employee_name} and a.employee_jumin=#{employee_jumin})
	and emptna_year=(to_number(to_char(sysdate,'yyyy'))) 
	 and emptna_month=(to_number(to_char(sysdate,'mm'))) 
	 and emptna_day=(to_number(to_char(sysdate,'dd')))
	 </update>
	
	<select id ="getEmpTnaList" parameterType="hashmap"
		resultType="com.cafe.erp.hr.model.empTnaDTO">
		select * from
		( select A.*, rownum r from( select b.emptna_code,a.employee_name,b.emptna_year,b.emptna_month,b.emptna_day,b.emptna_starttime,b.emptna_endtime,b.emptna_daytotaltime,b.emptna_monthtotaltime from cafe_employee a inner join cafe_emptna b on a.employee_code = b.emptna_empcode 
		order by emptna_code desc ) A) where r >= #{start} and r &lt;= #{end }

	</select>
	
	<select id="getEmpTnaCount" resultType="integer">
		SELECT COUNT(*)FROM cafe_empTna
	</select>
	 
	 <select id="getYear" resultType="com.cafe.erp.hr.model.empTnaDTO">
		select distinct emptna_year from cafe_emptna  
	</select>
	 
	 
	<select id="getMonth" resultType="com.cafe.erp.hr.model.empTnaDTO">
		select distinct emptna_month from cafe_emptna  
	</select>
	
	<select id="getDay" resultType="com.cafe.erp.hr.model.empTnaDTO">
		select distinct emptna_day from cafe_emptna  
	</select>
	
	<select id="getName" resultType="com.cafe.erp.hr.model.empTnaDTO">
		select employee_name from cafe_employee
	</select>
	
<!-- 	<select id="getEmpTna" parameterType="integer" resultType="com.cafe.erp.hr.model.empTnaDTO"> -->
<!-- 		select * from cafe_emptna where emptna_code=#{emptna_code} -->
<!-- 	</select> -->
	
	<select id="getMonthRead" parameterType="Hashmap" resultType="com.cafe.erp.hr.model.empTnaDTO">
		select b.emptna_code,a.employee_name,b.emptna_year,b.emptna_month,b.emptna_day,b.emptna_starttime,b.emptna_endtime,b.emptna_daytotaltime,b.emptna_monthtotaltime from cafe_employee a inner join cafe_emptna b on a.employee_code = b.emptna_empcode where b.emptna_year=#{emptna_year} and b.emptna_month=#{emptna_month} and a.employee_name=#{employee_name}
	</select>
	
	<select id="getDayRead" parameterType="Hashmap" resultType="com.cafe.erp.hr.model.empTnaDTO">
		select b.emptna_code,a.employee_name,b.emptna_year,b.emptna_month,b.emptna_day,b.emptna_starttime,b.emptna_endtime,b.emptna_daytotaltime,b.emptna_monthtotaltime from cafe_employee a inner join cafe_emptna b on a.employee_code = b.emptna_empcode where b.emptna_year=#{emptna_year} and b.emptna_month=#{emptna_month} and b.emptna_day=#{emptna_day}
	</select>
	
	<select id="getTotal" parameterType="Hashmap" resultType="integer">
	select sum (emptna_daytotaltime),0) from cafe_emptna 
	where emptna_year= to_number(to_char(sysdate,'yyyy')) 
    and emptna_month=to_number(to_char(sysdate,'mm')) 
    and emptna_empcode = (select distinct a.employee_code from cafe_employee a inner join cafe_emptna b 
    on a.employee_code = b.emptna_empcode where a.employee_name=#{employee_name} and a.employee_jumin=#{employee_jumin})
	</select>
	
</mapper>